<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GLB Viewer - FPS Mode</title>
  <style>
    body { margin: 0; overflow: hidden; font-family: sans-serif; background: #111; color: white; }
    #ui {
      position: absolute; top: 10px; left: 10px; z-index: 1;
      background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px;
    }
    #mini {
      position: absolute; top: 10px; right: 10px; width: 200px; height: 200px;
      border: 2px solid #fff; z-index: 1;
    }
  </style>
</head>
<body>
  <div id="ui">
    <label>GLB Model: <input type="file" id="modelUpload" accept=".glb" /></label><br>
    <label>Gravity: <input type="range" id="gravitySlider" min="0" max="20" step="0.1" value="9.8" /></label><br>
    <label>Jump Power: <input type="range" id="jumpSlider" min="1" max="20" step="0.1" value="5" /></label><br>
    <label>Lighting:
      <select id="lightPreset">
        <option value="day">‚òÄÔ∏è Siang</option>
        <option value="night">üåô Malam</option>
        <option value="custom">Manual</option>
      </select>
    </label><br>
    <div id="customLight" style="display: none;">
      <label>Directional Intensity: <input type="range" id="dirLight" min="0" max="2" step="0.1" value="1" /></label><br>
      <label>Ambient Intensity: <input type="range" id="ambLight" min="0" max="2" step="0.1" value="0.4" /></label><br>
    </div>
  </div>
  <canvas id="mini"></canvas>

  <script type="module">
    import * as THREE from './js/three.module.js';
    import { GLTFLoader } from './js/GLTFLoader.js';
    import { FirstPersonControls } from './js/FirstPersonControls.js';

    let camera, scene, renderer, controls, clock;
    let model, gravity = 9.8, jumpPower = 5;
    let dirLight, ambLight;

    const velocity = new THREE.Vector3();
    let canJump = false;

    init();
    animate();

    function init() {
      clock = new THREE.Clock();
      scene = new THREE.Scene();

      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 1.8, 5);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      dirLight = new THREE.DirectionalLight(0xffffff, 1);
      dirLight.position.set(3, 10, 3);
      scene.add(dirLight);

      ambLight = new THREE.AmbientLight(0xffffff, 0.4);
      scene.add(ambLight);

      controls = new FirstPersonControls(camera, renderer.domElement);
      controls.lookSpeed = 0.1;
      controls.movementSpeed = 5;
      controls.lookVertical = true;
      controls.enabled = true;

      loadModel('model.glb');

      document.getElementById('gravitySlider').oninput = e => gravity = parseFloat(e.target.value);
      document.getElementById('jumpSlider').oninput = e => jumpPower = parseFloat(e.target.value);

      document.getElementById('modelUpload').addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (!file) return;
        const url = URL.createObjectURL(file);
        loadModel(url);
      });

      document.getElementById('lightPreset').addEventListener('change', updateLightingPreset);
      document.getElementById('dirLight').addEventListener('input', () => dirLight.intensity = parseFloat(dirLightSlider.value));
      document.getElementById('ambLight').addEventListener('input', () => ambLight.intensity = parseFloat(ambLightSlider.value));
    }

    function loadModel(url) {
      if (model) scene.remove(model);
      new GLTFLoader().load(url, gltf => {
        model = gltf.scene;
        scene.add(model);
      });
    }

    function updateLightingPreset(e) {
      const val = e.target.value;
      document.getElementById('customLight').style.display = val === 'custom' ? 'block' : 'none';
      if (val === 'day') {
        dirLight.intensity = 1;
        ambLight.intensity = 0.4;
        scene.background = new THREE.Color(0xa0d0ff);
      } else if (val === 'night') {
        dirLight.intensity = 0.3;
        ambLight.intensity = 0.2;
        scene.background = new THREE.Color(0x101020);
      }
    }

    function animate() {
      requestAnimationFrame(animate);

      const delta = clock.getDelta();
      controls.update(delta);

      velocity.y -= gravity * delta;
      camera.position.y += velocity.y * delta;

      if (camera.position.y < 1.8) {
        velocity.y = 0;
        camera.position.y = 1.8;
        canJump = true;
      }

      renderer.setViewport(0, 0, window.innerWidth, window.innerHeight);
      renderer.render(scene, camera);
    }

    document.addEventListener('keydown', e => {
      if (e.code === 'Space' && canJump) {
        velocity.y += jumpPower;
        canJump = false;
      }
    });
  </script>
</body>
</html>
