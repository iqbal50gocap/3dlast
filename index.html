<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GLB Viewer with Camera Switch & Proximity UI</title>
  <style>
    body { margin: 0; overflow: hidden; font-family: sans-serif; }
    #cameraButtons {
      position: absolute; top: 10px; left: 10px;
      background: rgba(0,0,0,0.7); color: white;
      padding: 10px; border-radius: 5px;
    }
    #drawerButtons {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: none;
      gap: 10px;
    }
    #drawerButtons button {
      padding: 10px 15px;
      background: #333; color: white;
      border: none; border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="cameraButtons"></div>
  <div id="drawerButtons">
    <button onclick="playAnim('opendrawer')">Open</button>
    <button onclick="playAnim('closedrawer')">Close</button>
  </div>
  <script type="module">
    import * as THREE from './js/three.module.js';
    import { GLTFLoader } from './js/GLTFLoader.js';
    import { DRACOLoader } from './js/DRACOLoader.js';
    import { OrbitControls } from './js/OrbitControls.js';

    let camera, scene, renderer, controls, mixer, clock = new THREE.Clock();
    let animations = {}, cameraList = [], currentCamera;
    let drawerObject = null;

    const drawerButtons = document.getElementById('drawerButtons');

    init();

    function init() {
      scene = new THREE.Scene();

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.outputEncoding = THREE.sRGBEncoding;
      renderer.toneMappingExposure = 1.0;
      renderer.physicallyCorrectLights = true;
      document.body.appendChild(renderer.domElement);

      camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 100);
      camera.position.set(2, 1.5, 2);

      controls = new OrbitControls(camera, renderer.domElement);

      const dracoLoader = new DRACOLoader();
      dracoLoader.setDecoderPath('./js/draco/');

      const loader = new GLTFLoader();
      loader.setDRACOLoader(dracoLoader);

      loader.load('untitled.glb', (gltf) => {
        const model = gltf.scene;
        scene.add(model);

        // Ambil kamera dari nama view1, view2, dll
        const camNames = ['view1', 'view2'];
        camNames.forEach(name => {
          const camObj = model.getObjectByName(name);
          if (camObj && camObj.isCamera) {
            cameraList.push(camObj);
          }
        });
        createCameraButtons();

        // Animations
        mixer = new THREE.AnimationMixer(model);
        gltf.animations.forEach(clip => {
          animations[clip.name] = clip;
        });

        // Drawer
        drawerObject = model.getObjectByName('drawer') || model;
      });

      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      animate();
    }

    function createCameraButtons() {
      const btnContainer = document.getElementById('cameraButtons');
      btnContainer.innerHTML = '';
      cameraList.forEach((cam, idx) => {
        const btn = document.createElement('button');
        btn.innerText = cam.name || `Camera ${idx+1}`;
        btn.onclick = () => {
          currentCamera = cam;
          controls.object = currentCamera;
          controls.update();
        };
        btnContainer.appendChild(btn);
      });
    }

    window.playAnim = function(name) {
      if (animations[name]) {
        mixer.stopAllAction();
        mixer.clipAction(animations[name]).reset().play();
      }
    }

    function animate() {
      requestAnimationFrame(animate);

      const dt = clock.getDelta();
      mixer?.update(dt);

      if (drawerObject) {
        const distance = camera.position.distanceTo(drawerObject.getWorldPosition(new THREE.Vector3()));
        drawerButtons.style.display = distance < 2 ? 'flex' : 'none';
      }

      renderer.render(scene, currentCamera || camera);
    }
  </script>
</body>
</html>
