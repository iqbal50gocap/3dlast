<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Viewer Kamera & Animasi</title>
  <style>
    body { margin: 0; overflow: hidden; }
    #camera-ui {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(0,0,0,0.5);
      padding: 10px;
      color: white;
      font-family: sans-serif;
      font-size: 14px;
    }
    select {
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div id="camera-ui">
    View: 
    <select id="cameraSelect"></select>
  </div>

  <script type="module">
    import * as THREE from './js/three.module.js';
    import { OrbitControls } from './js/OrbitControls.js';
    import { GLTFLoader } from './js/GLTFLoader.js';
    import { DRACOLoader } from './js/DRACOLoader.js';

    let scene, renderer, camera, mixer;
    let cameraMap = {};
    const clock = new THREE.Clock();

    scene = new THREE.Scene();
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.set(0, 2, 5);
    const controls = new OrbitControls(camera, renderer.domElement);

    // Lighting
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
    directionalLight.position.set(5, 10, 7);
    scene.add(directionalLight);
    scene.add(new THREE.AmbientLight(0xffffff, 0.3));

    // DRACO Setup
    const dracoLoader = new DRACOLoader();
    dracoLoader.setDecoderPath('./js/draco/');

    // Load Model
    const loader = new GLTFLoader();
    loader.setDRACOLoader(dracoLoader);

    loader.load('untitled.glb', (gltf) => {
      const model = gltf.scene;
      scene.add(model);

      mixer = new THREE.AnimationMixer(model);
      gltf.animations.forEach(clip => {
        const action = mixer.clipAction(clip);
        action.setLoop(THREE.LoopOnce);
        action.clampWhenFinished = true;
      });

      // Kamera dari GLB
      gltf.cameras?.forEach((cam, idx) => {
        const name = cam.name || `Camera${idx + 1}`;
        cameraMap[name] = cam;

        const option = document.createElement("option");
        option.value = name;
        option.textContent = (name === "view1") ? "Tampak Depan" :
                             (name === "view2") ? "Tampak Samping" :
                             name;
        document.getElementById("cameraSelect").appendChild(option);
      });
    });

    // Ganti kamera
    document.getElementById("cameraSelect").addEventListener("change", (e) => {
      const selected = cameraMap[e.target.value];
      if (selected) {
        camera.position.copy(selected.position);
        camera.rotation.copy(selected.rotation);
        camera.fov = selected.fov;
        camera.updateProjectionMatrix();
      }
    });

    // Render loop
    function animate() {
      requestAnimationFrame(animate);
      const delta = clock.getDelta();
      if (mixer) mixer.update(delta);
      renderer.render(scene, camera);
    }
    animate();

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
